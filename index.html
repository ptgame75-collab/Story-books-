<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ludo Prank Pro</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkx1ZG8gUHJhbmsgUHJvIiwKICAic2hvcnRfbmFtZSI6ICJMdWRvIiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmZmZmZmYiLAogICJ0aGVtZV9jb2xvciI6ICIjMmU0YTZiIgp9">
    <style>
        :root {
            --red: #e74c3c; --green: #2ecc71; --yellow: #f1c40f; --blue: #3498db;
            --white: #ffffff; --black: #2c3e50;
        }
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f0f0; margin: 0; }
        
        /* Logo Styling */
        .logo-container { margin: 10px; width: 80px; height: 80px; border-radius: 50%; overflow: hidden; border: 3px solid var(--black); }
        .logo-container img { width: 100%; height: 100%; object-fit: cover; }

        .ludo-board {
            width: 360px; height: 360px; display: grid;
            grid-template-columns: repeat(15, 1fr); grid-template-rows: repeat(15, 1fr);
            border: 4px solid #333; background: #fff;
        }
        .box { border: 0.5px solid #000; box-sizing: border-box; }
        .base { grid-column: span 6; grid-row: span 6; position: relative; border: 1px solid #000; }
        .red { background: var(--red); } .green { background: var(--green); }
        .blue { background: var(--blue); } .yellow { background: var(--yellow); }
        .center { grid-column: 7/10; grid-row: 7/10; background: #eee; border: 1px solid #000; }
        
        /* Path coloring for specific cells like your image */
        .path-g { background: var(--green); } .path-r { background: var(--red); }
        .path-y { background: var(--yellow); } .path-b { background: var(--blue); }

        .controls { text-align: center; margin-top: 20px; }
        #dice { width: 60px; height: 60px; background: white; border: 2px solid #333; border-radius: 10px; 
                display: flex; justify-content: center; align-items: center; font-size: 2rem; cursor: pointer; margin: 10px auto; }
        .btn-install { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; display: none; }
    </style>
</head>
<body>

    <div class="logo-container">
        <img src="https://via.placeholder.com/150" alt="Logo" id="userLogo">
    </div>

    <div class="ludo-board">
        <div class="base red"></div> <div class="box"></div><div class="box"></div><div class="box"></div> <div class="base green"></div>
        <div class="box"></div><div class="box path-r"></div><div class="box"></div> <div class="center"></div> <div class="box"></div><div class="box path-g"></div><div class="box"></div>
        <div class="base blue"></div> <div class="box"></div><div class="box"></div><div class="box"></div> <div class="base yellow"></div>
    </div>

    <div class="controls">
        <div id="status">पालो: <b style="color:var(--green)">GREEN</b></div>
        <div id="dice" onclick="roll()">?</div>
        <button id="installBtn" class="btn-install">एप Install गर्नुहोस्</button>
    </div>

    <script>
        let turn = 'green';
        const players = ['green', 'red', 'blue', 'yellow'];
        let pIdx = 0;
        
        // Prank Sequence for Green: 6, 6, 1, 6
        let greenSequence = [6, 6, 1, 6];
        let seqIndex = 0;

        function roll() {
            let dice = document.getElementById('dice');
            let result;

            if (turn === 'green') {
                // १. हरियोको पालामा निश्चित क्रम (6, 6, 1, 6)
                if (seqIndex < greenSequence.length) {
                    result = greenSequence[seqIndex];
                    seqIndex++;
                } else {
                    // Sequence सकिएपछि जे पर्दा नि हुन्छ (Random)
                    result = Math.floor(Math.random() * 6) + 1;
                }
            } else {
                // २. अरूको लागि पूर्ण Random
                result = Math.floor(Math.random() * 6) + 1;
            }

            dice.innerText = result;

            // ३. नियम: ६ वा १ (पोर) पर्दा फेरि हान्न पाउने
            if (result !== 6 && result !== 1) {
                pIdx = (pIdx + 1) % 4;
                turn = players[pIdx];
                seqIndex = 0; // अर्को पालोमा Sequence सुरुबाट
                document.getElementById('status').innerHTML = `पालो: <b style="color:var(--${turn})">${turn.toUpperCase()}</b>`;
            }
        }

        // PWA Install Logic
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault(); deferredPrompt = e;
            document.getElementById('installBtn').style.display = 'inline-block';
        });

        document.getElementById('installBtn').addEventListener('click', () => {
            if (deferredPrompt) deferredPrompt.prompt();
        });

        // Service Worker for Installation
        if ('serviceWorker' in navigator) {
            const swCode = `self.addEventListener('fetch', e => e.respondWith(fetch(e.request)));`;
            const blob = new Blob([swCode], { type: 'application/javascript' });
            navigator.serviceWorker.register(URL.createObjectURL(blob));
        }
    </script>
</body>
</html>
